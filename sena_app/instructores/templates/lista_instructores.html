{% extends 'base.html' %}

{% load static %}

{% block title %}Lista de Instructores - SENA APP Centro Minero{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 fw-bold mb-0">Lista de Instructores</h1>
    <p class="text-muted small mb-0">Gestión y administración de instructores activos</p>
  </div>
  <div class="d-flex align-items-center gap-2">
    <span class="badge text-bg-success">Instructores: {{ total_instructores }}</span>
    <a href="{% url 'instructor_create' %}" class="btn btn-primary shadow-sm">
      <span class="fw-semibold">+ Nuevo Instructor</span>
    </a>
    <a href="{% url 'admin:index' %}" class="btn btn-outline-dark shadow-sm">
      <span class="fw-semibold"><i class="bi bi-speedometer2 me-1"></i> Panel Admin</span>
    </a>
  </div>
</div>

<div class="card shadow-sm border-0 mb-4">
  <div class="card-body py-3 px-4 bg-light-subtle">
    <div class="row g-3 align-items-center">
      <div class="col-md-3">
        <label class="form-label fw-semibold mb-1">Buscar</label>
        <div class="input-group">
          <span class="input-group-text bg-dark text-white"><i class="bi bi-search"></i></span>
          <input type="text" id="instructorSearch" class="form-control" placeholder="Filtrar por nombre, documento, especialidad o ciudad..." aria-label="Buscar instructores">
        </div>
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold mb-1">Especialidad</label>
        <select id="filtroEspecialidad" class="form-select" aria-label="Filtrar por especialidad">
          <option value="" selected>Todas</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold mb-1">Ciudad</label>
        <select id="filtroCiudad" class="form-select" aria-label="Filtrar por ciudad">
          <option value="" selected>Todas</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label fw-semibold mb-1">Estado</label>
        <select id="filtroActivo" class="form-select" aria-label="Filtrar por estado">
          <option value="" selected>Todos</option>
          <option value="activo">Activos</option>
          <option value="inactivo">Inactivos</option>
        </select>
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0 sena-table align-middle" id="tablaInstructores">
        <thead class="table-dark">
          <tr>
            <th><button class="table-sort" data-col="0" type="button">Documento <i class="bi bi-arrow-down-up"></i></button></th>
            <th><button class="table-sort" data-col="1" type="button">Nombre <i class="bi bi-arrow-down-up"></i></button></th>
            <th><button class="table-sort" data-col="2" type="button">Apellido <i class="bi bi-arrow-down-up"></i></button></th>
            <th><button class="table-sort" data-col="3" type="button">Especialidad <i class="bi bi-arrow-down-up"></i></button></th>
            <th><button class="table-sort" data-col="4" type="button">Nivel <i class="bi bi-arrow-down-up"></i></button></th>
            <th><button class="table-sort" data-col="5" type="button">Años Exp. <i class="bi bi-arrow-down-up"></i></button></th>
            <th><button class="table-sort" data-col="6" type="button">Estado <i class="bi bi-arrow-down-up"></i></button></th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for inst in instructores %}
          <tr data-especialidad="{{ inst.especialidad }}" data-ciudad="{{ inst.ciudad }}" data-activo="{% if inst.activo %}activo{% else %}inactivo{% endif %}">
            <td class="fw-semibold">{{ inst.documento_identidad }}</td>
            <td>{{ inst.nombre }}</td>
            <td>{{ inst.apellido }}</td>
            <td><span class="badge text-bg-warning text-dark fw-semibold">{{ inst.especialidad }}</span></td>
            <td><span class="badge text-bg-dark">{{ inst.get_nivel_educativo_display }}</span></td>
            <td>{{ inst.anos_experiencia }}</td>
            <td>{% if inst.activo %}<span class="badge text-bg-success">Activo</span>{% else %}<span class="badge text-bg-secondary">Inactivo</span>{% endif %}</td>
            <td class="text-end">
              <div class="btn-group btn-group-sm" role="group">
                <a href="{% url 'detalle_instructor' inst.id %}" class="btn btn-outline-primary" title="Ver"><i class="bi bi-eye"></i></a>
                <a href="{% url 'instructor_update' inst.id %}" class="btn btn-outline-warning" title="Editar"><i class="bi bi-pencil"></i></a>
                <a href="{% url 'instructor_delete' inst.id %}" class="btn btn-outline-danger" title="Eliminar"><i class="bi bi-trash"></i></a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="8" class="text-center text-muted py-4">No hay instructores registrados.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% if page_obj %}
<nav class="mt-3" aria-label="Paginación de instructores">
  <ul class="pagination pagination-sm justify-content-end">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Anterior</span></li>
    {% endif %}

    {% for p in page_obj.paginator.page_range %}
      <li class="page-item {% if page_obj.number == p %}active{% endif %}"><a class="page-link" href="?page={{ p }}">{{ p }}</a></li>
    {% endfor %}

    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Siguiente</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
    {% endif %}
  </ul>
</nav>
{% endif %}

<!-- Modal de confirmación genérico -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-trash3 text-danger"></i> Confirmar eliminación</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        ¿Seguro que deseas eliminar este instructor?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Eliminar</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'instructores/js/instructores.js' %}"></script>
<script>
  document.addEventListener('click', function(e){
    const btn = e.target.closest('a.btn.btn-outline-danger');
    if(!btn) return;
    e.preventDefault();
    const href = btn.getAttribute('href');
    const modalEl = document.getElementById('confirmDeleteModal');
    const confirmBtn = document.getElementById('confirmDeleteBtn');
    if(modalEl && confirmBtn){
      confirmBtn.setAttribute('href', href);
      const modal = new bootstrap.Modal(modalEl);
      modal.show();
    }
  });
</script>
{% endblock %}
